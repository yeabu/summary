<view class="page">
<block wx:if="{{items && items.length}}">
  <view class="cell-group">
    <view class="cell product-card" wx:for="{{items}}" wx:key="id">
      <view class="product-card-header">
        <view class="product-info">
          <text class="cell-title">{{item.name}}</text>
          <text class="cell-desc">{{item.spec || item.base_unit || '无规格信息'}}</text>
        </view>
        <view class="product-price">
          <text class="cell-value">{{item.currency}} {{item.unit_price_fmt}}</text>
          <text class="cell-desc">{{item.supplierName || '未指定供应商'}}</text>
        </view>
      </view>
      <view class="product-actions">
        <button size="mini" bindtap="openPurchaseParam" data-id="{{item.id}}">采购参数</button>
        <button size="mini" bindtap="onEdit" data-id="{{item.id}}">编辑</button>
        <button size="mini" type="warn" bindtap="onDelete" data-id="{{item.id}}">删除</button>
      </view>
    </view>
  </view>
</block>
<block wx:else>
  <view class="empty"><text>暂无商品数据</text></view>
</block>

<view class="fab" bindtap="openCreate" style="{{fabStyle}}">
  <view class="fab-inner">
    <view class="fab-bar"></view>
    <view class="fab-bar v"></view>
  </view>
</view>

<view class="sheet" wx:if="{{formOpen}}">
  <view class="sheet-body">
    <view class="row" style="justify-content: space-between; align-items:center;">
      <text style="font-weight:600;">{{form.id ? '编辑商品' : '新增商品'}}</text>
      <button size="mini" bindtap="closeForm">关闭</button>
    </view>
    <view class="cell-group">
      <view class="cell"><text class="cell-title">名称</text><input class="input" value="{{form.name}}" bindinput="iName"/></view>
      <view class="cell"><text class="cell-title">单位</text><input class="input" value="{{form.base_unit}}" bindinput="iUnit"/></view>
      <view class="cell"><text class="cell-title">规格</text><input class="input" value="{{form.spec}}" bindinput="iSpec"/></view>
      <view class="cell"><text class="cell-title">单价</text><input class="input" type="number" value="{{form.unit_price}}" bindinput="iPrice"/></view>
      <view class="cell">
        <text class="cell-title">币种</text>
        <picker mode="selector" range="{{currencyLabels}}" value="{{currencyIndex}}" bindchange="onCurrency">
          <view class="picker">{{currencyLabels[currencyIndex]}}</view>
        </picker>
      </view>
      <view class="cell">
        <text class="cell-title">供应商</text>
        <picker mode="selector" range="{{supplierNames}}" value="{{supplierIndex}}" bindchange="onSupplier">
          <view class="picker">{{supplierNames[supplierIndex] || '未指定'}}</view>
        </picker>
      </view>
    </view>
    <view class="spacer"></view>
    <button class="btn-primary" style="background: {{themeColor}}; border-color: {{themeColor}};" bindtap="save" loading="{{saving}}">保存</button>
  </view>
</view>

<view class="sheet" wx:if="{{purchaseFormOpen}}">
  <view class="sheet-body">
    <view class="row" style="justify-content: space-between; align-items:center;">
      <text style="font-weight:600;">采购参数 - {{purchaseForm.product_name}}</text>
      <button size="mini" bindtap="closePurchaseForm">关闭</button>
    </view>
    <view class="cell-group">
      <view class="cell">
        <text class="cell-title">采购单位</text>
        <input class="input" value="{{purchaseForm.unit}}" bindinput="iPurchaseUnit" placeholder="输入采购单位"/>
        <text class="cell-desc" wx:if="{{purchaseForm.base_unit}}">基准单位：{{purchaseForm.base_unit}}</text>
      </view>
      <view class="cell">
        <text class="cell-title">换算系数</text>
        <input class="input" type="digit" value="{{purchaseForm.factor}}" bindinput="iPurchaseFactor" placeholder="1 表示与基准单位相同"/>
        <text class="cell-desc">数量换算为 {{purchaseForm.base_unit || '基准单位'}} 时乘以该系数</text>
      </view>
      <view class="cell">
        <text class="cell-title">采购单价</text>
        <input class="input" type="digit" value="{{purchaseForm.price}}" bindinput="iPurchasePrice" placeholder="请输入采购单价"/>
        <text class="cell-desc">{{purchaseForm.currency}} 币种</text>
      </view>
    </view>
    <view class="spacer"></view>
    <button class="btn-primary" style="background: {{themeColor}}; border-color: {{themeColor}};" bindtap="savePurchaseParam" loading="{{purchaseSaving}}">保存采购参数</button>
  </view>
</view>
</view>
<bottom-nav active="inventory" />
