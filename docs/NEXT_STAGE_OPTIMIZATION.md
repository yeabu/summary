# 下一阶段优化方案（建议）

以下方案按投入产出比排序，覆盖用户体验、性能与可靠性。

## 1. 前端体验
- 导航统一化：
  - 完善图标与激活规则，移动端抽屉细化分组与搜索。
  - 无数据态（Empty States）统一组件化，支持操作建议与快捷入口。
- 交互一致性：
  - 删除与危险操作统一 ConfirmDialog，支持文案/副作用预览。
  - 表单校验/错误提示统一到 Form helper（含批量导入校验反馈）。
- 列表可用性：
  - 固定表头、列宽自适应、列选择/顺序保存到 localStorage。
  - 导出 CSV/XLSX 统一工具，支持后台任务下载（大数据量）。

## 2. 前端性能
- 构建与加载：
  - 按路由与组件拆包（动态 import）、图标按需引入。
  - 开启生产资源 gzip/br（Nginx 配置）。
- 数据获取：
  - SWR/React Query 接入，缓存与请求去重；乐观更新减少等待。
  - 表格分页服务端化（保留页码/筛选在 URL）。

## 3. 后端可观测性
- 结构化日志：请求 ID、用户、耗时、SQL 影响行数；按级别输出到 stdout。
- 指标暴露：/metrics (Prometheus)，请求 QPS、P95、错误率、DB 连接池使用。
- 追踪：可选 OpenTelemetry（HTTP + GORM hook）。

## 4. 可靠性与安全
- 配置管理：
  - 使用 `.env` 与环境变量映射；敏感值（JWT_SECRET、DB 密码）统一通过 Secret 管理（K8s/Secrets Manager）。
- 认证授权：
  - JWT 刷新/过期处理完善；权限中间件覆盖所有写接口。
  - 初始管理员引导流程（首次启动时自动生成一次性管理员）。
- 备份与迁移：
  - MySQL 定时备份 + 恢复演练；变更通过迁移脚本（go-migrate 或 GORM Migrator）。

## 5. 数据与查询
- 关键索引补充：
  - 应付款：supplier_id、base_id、status、due_date 组合索引。
  - 采购/开支：日期、供应商/基地、创建人。
- 报表加速：
  - 按月聚合表（物化视图思路），每日/每次变更增量更新。

## 6. 部署与交付
- 容器镜像：
  - 后端使用 distroless（已启用），多阶段构建确保体积小与安全性。
  - 前端 Nginx 打开 gzip/br 与缓存头；/api 反代启用连接复用与超时。
- CI/CD：
  - Lint/Test/Build/Scan；主分支自动打镜像与推送（Tag 含 Git SHA）。
  - 不同环境通过 compose/Helm 值文件区分配置。

## 7. 质量保障
- 单元/集成用例：
  - 后端 handler + service 层核心路径；
  - 前端关键页面快照 + 行为测试（筛选/分页/导出）。
- E2E：
  - 登录-开支录入-应付款联动回归；
  - 大数据量列表响应与导出正确性。

## 里程碑建议
- M1（1-2 周）：导航与删除交互统一、基础指标/日志、关键索引、构建与 Nginx 优化。
- M2（2-3 周）：SWR/React Query 接入、报表聚合表、初始化管理员引导。
- M3（2 周）：CI/CD 完成、E2E 自动化、备份与恢复手册化与演练。

